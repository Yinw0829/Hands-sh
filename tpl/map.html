<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>逆地理编码</title>
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css" />
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=052fbbc689029fcffff1d43e007e1407&plugin=AMap.Geocoder"></script>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
</head>

<body onload="regeocoder()">
    <div id="container"></div>
    <div id="tip">
        <b>经纬度 <span id="fist"></span> <span id="second"></span> 的地理编码结果:</b>
        <span id="result"></span>
    </div>
    <script type="text/javascript">
        var mapObj, geolocation;
        var result;

        function mapInit() {
            mapObj = new AMap.Map('container'); //默认定位：初始化加载地图时，center及level属性缺省，地图默认显示用户所在城市范围
        };
        var map = new AMap.Map("container", {
            resizeEnable: true,
        });
        //默认二个坐标点，这里应该要用IP来取位置
        var fistMap;
        var secondMap;
        var marker;
        //获取页面上二个伟放经纬度的对象
        var fistSpan = document.getElementById('fist');
        var secondSpan = document.getElementById('second');

        lnglatXY = [fistMap, secondMap]; //已知点坐标
        function regeocoder() { //逆地理编码
            var geocoder = new AMap.Geocoder({
                radius: 1000,
                extensions: "all"
            });
            geocoder.getAddress(lnglatXY, function (status, result) {
                if (status === 'complete' && result.info === 'OK') {
                    geocoder_CallBack(result);
                }
            });
            marker = new AMap.Marker({ //加点
                map: map,
                position: lnglatXY
            });
            map.setFitView();
        };

        function geocoder_CallBack(data) {
            var address = data.regeocode.formattedAddress; //返回地址描述
            document.getElementById("result").innerHTML = address;
        };

        fistSpan.innerHTML = fistMap;
        secondSpan.innerHTML = secondMap;
        map.on('click', function (e) {
            var getLng = e.lnglat.getLng();
            var getLat = e.lnglat.getLat();
            fistMap = getLng;
            secondMap = getLat;
            //改变存放经纬度对象的内容
            fistSpan.innerHTML = fistMap;
            secondSpan.innerHTML = secondMap;
            //删除原来的点
            map.remove(marker);
            lnglatXY = [fistMap, secondMap]; //已知点坐标
            //把点的定位再执行一次
            regeocoder();
            console.log('经纬度1：' + getLng + '经纬度2：' + getLat)
        });
    </script>
</body>

</html>